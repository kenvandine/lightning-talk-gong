name: lightning-talk-gong
version: "0.1"
summary: Lightning Talk Gong
description: |
  When the gong goes bong, stop talking!
grade: stable
confinement: strict
base: core18

architectures:
  - build-on: amd64

apps:
  lightning-talk-gong:
    command: bin/lightning_talk_gong
    extensions: [gnome-3-28]
    plugs:
      - opengl
      - audio-playback
    environment:
      LD_LIBRARY_PATH: $SNAP/bin/lib:$LD_LIBRARY_PATH
      __EGL_VENDOR_LIBRARY_DIRS: $SNAP/usr/share/glvnd/egl_vendor.d/

parts:
  lightning-talk-gong:
    source: .
    plugin: flutter
    flutter-channel: master
    flutter-target: lib/main.dart
    override-build: |
      set -eux
      snapcraftctl build
      mkdir -p $SNAPCRAFT_PART_INSTALL/bin/lib
      cp $SNAPCRAFT_PART_INSTALL/../src/gong.wav $SNAPCRAFT_PART_INSTALL/
      find /root/snap/flutter/common/flutter/.pub-cache/ -name libunixdomainsocket.so -exec cp {} $SNAPCRAFT_PART_INSTALL/bin/lib/ \;
    build-snaps:
      - flutter/latest/edge

  libraries:
    plugin: nil
    stage-packages:
      - pulseaudio-utils
      - libegl-mesa0
